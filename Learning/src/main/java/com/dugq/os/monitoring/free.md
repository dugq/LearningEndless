# free 命令
* free -h -s 【刷新频率】  可以把-h 替换为-m -k 单位指定为MB或者KB

## 详解
![](../resource/free.png)
### 行说明
Mem : 指的是内存量
Swap : 指的是交换区
### 列说明
* total : 内存总量
* used : 已分配内存量
* free : 未分配内存量
* shared : 被共享使用的物理内存大小
* buff/cache:  列显示被 buffer 和 cache 使用的物理内存大小
* available 列显示还可以被应用程序使用的物理内存大小

## 难点
### 1、used + free + shared + buff/cache = total

### 2、buff/cache
##### 2.1 buff
* 在操作系统中指 buffer cache， 中文一般翻译为 "缓冲区"。
* 要理解缓冲区，必须明确另外两个概念："扇区" 和 "块"。
  * 扇区是设备的最小寻址单元，也叫 "硬扇区" 或 "设备块"。
  * 块是操作系统中文件系统的最小寻址单元，也叫 "文件块" 或 "I/O 块"。
  * 每个块包含一个或多个扇区，但大小不能超过一个页面，所以一个页可以容纳一个或多个内存中的块。
* 当一个块被调入内存时，它要存储在一个缓冲区中。
* 每个缓冲区与一个块对应，它相当于是磁盘块在内存中的表示
* buffer cache 只有块的概念而没有文件的概念，它只是把磁盘上的块直接搬到内存中而不关心块中究竟存放的是什么格式的文件
* 这里其实可以理解为：
  * 应用想要读取文件，但是操作系统把文件系统和应用隔离开来的，应用是不能直接读取文件的
  * 如果应用需要读取文件，需要调用操作系统的API，操作系统会根据文件的地址查找到对应的扇区
  * 把扇区上对应的数据流读取到buffer块中，然后操作系统根据文件偏移量读取字节流再转交给应用
  * 这里牵涉两个相关
    * 1、零copy 相关知识 
    * 2、文件读取 和 磁盘存储相关知识
##### 2.2 cache
* cache 在操作系统中指 page cache，中文一般翻译为 "页高速缓存"。
* 页高速缓存是内核实现的磁盘缓存。它主要用来减少对磁盘的 I/O 操作。
* 具体地讲，是通过把磁盘中的数据缓存到物理内存中，把对磁盘的访问变为对物理内存的访问。
* 页高速缓存缓存的是内存页面。
  * 缓存中的页来自对普通文件、块设备文件(这个指的就是 buffer cache)和内存映射文件的读写
* 简而言之： 当内核要读一个文件时，它会先检查这个文件的数据是不是已经在页高速缓存中了。如果在，就放弃访问磁盘，直接从内存中读取。这个行为称为缓存命中。如果数据不在缓存中，就是未命中缓存，此时内核就要调度块 I/O 操作从磁盘去读取数据。然后内核将读来的数据放入页高速缓存中。这种缓存的目标是文件系统可以识别的文件。


### 3、free 与 available

##### 3.1 free
* 空闲内存，指的是未被分配出去的内存区域。
* 这些区域不一定是连接在一起的
* 区域内容也不一定是空白的，但一定是无主的

#### 3.2 available
* 可以使用的内存区域
* 有些内存区域被 buff/cache占用，如果操作系统需要，这部分区域可以被收回
* 理论上来说 available = cache/buffer + free
* 但实际中，cache/buffer 是不能被全部释放的，它包含的内容用处可以在很多场景


### 4 、swap
* 交换空间
* 当RAM物理内存满时，操作系统会将部分不常用的内存数据占时存放到物理磁盘中
* 这牵涉到虚拟内存 技术
* 当swap 的used 不为零时，说明物理内存溢出，或者曾经溢出过

## /proc/meminfo 文件
使用命令 cat /proc/meminfo 可以看到更多内存相关信息。 free命令也只是提取归纳了部分 
